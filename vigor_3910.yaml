zabbix_export:
  version: '6.2'
  date: '2023-05-12T08:34:17Z'
  template_groups:
    -
      uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    -
      uuid: 14af9d7b44a84e1ab2a909b6d6942362
      template: vigor3910
      name: vigor3910
      description: 'Zabbix template for monitoring Draytek router/firewall'
      groups:
        -
          name: Templates/Modules
      items:
        -
          uuid: 537930d091ac49aca10a904b01bd5462
          name: 'Device Info'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.7367.3.1.0
          key: device.info
        -
          uuid: 3a0632f4629045c4b9674cd32e14a900
          name: 'ICMP ping'
          type: SIMPLE
          key: icmpping
          delay: 2m
          history: 1w
          tags:
            -
              tag: Application
              value: General
          triggers:
            -
              uuid: bcb5e5c611694d7ab36b8838e63b887f
              expression: 'max(/vigor3910/icmpping,#3)=0'
              name: 'Unavailable by ICMP ping'
              priority: HIGH
              description: |
                Last value: {ITEM.LASTVALUE1}.
                Last three attempts returned timeout.  Please check device connectivity.
        -
          uuid: 41a86835a89b41408c9d298f61546584
          name: 'ICMP loss'
          type: SIMPLE
          key: icmppingloss
          delay: 2m
          history: 1w
          value_type: TEXT
          units: '%'
          tags:
            -
              tag: Application
              value: Status
          triggers:
            -
              uuid: 1aa83c696e09492fb1c7996fc2675618
              expression: 'min(/vigor3910/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/vigor3910/icmppingloss,5m)<100'
              name: 'High ICMP ping loss'
              priority: WARNING
              description: 'Last value: {ITEM.LASTVALUE1}.'
              dependencies:
                -
                  name: 'Unavailable by ICMP ping'
                  expression: 'max(/vigor3910/icmpping,#3)=0'
        -
          uuid: 22a10d76ecee42bbb7d2553c7a1ec9f9
          name: 'ICMP response time'
          type: SIMPLE
          key: icmppingsec
          delay: 2m
          history: 1w
          units: s
          tags:
            -
              tag: Application
              value: Status
          triggers:
            -
              uuid: b37bf11fd6f34cc3b2328914c00d1123
              expression: 'avg(/vigor3910/icmppingsec,5m)>{$ICMP_RESPONSE_TIME_WARN}'
              name: 'High ICMP ping response time'
              priority: WARNING
              description: 'Last value: {ITEM.LASTVALUE1}.'
              dependencies:
                -
                  name: 'High ICMP ping loss'
                  expression: 'min(/vigor3910/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/vigor3910/icmppingloss,5m)<100'
                -
                  name: 'Unavailable by ICMP ping'
                  expression: 'max(/vigor3910/icmpping,#3)=0'
        -
          uuid: 37e30e65c1bc4d838eb7326e5f980a76
          name: 'SNMP traps (fallback)'
          type: SNMP_TRAP
          key: snmptrap.fallback
          delay: 5m
          history: 2w
          trends: '0'
          value_type: LOG
          description: 'Item is used to collect all SNMP traps unmatched by other snmptrap items'
          logtimefmt: 'hh:mm:sszyyyy/MM/dd'
          tags:
            -
              tag: Application
              value: General
        -
          uuid: dda53cce41a44fe69b85ca40b76d87b9
          name: 'Device contact details'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.4.0
          key: system.contact
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: |
            MIB: SNMPv2-MIB
            The textual identification of the contact person for this managed node, together with information on how to contact this person.  If no contact information is known, the value is the zero-length string.
          inventory_link: CONTACT
          tags:
            -
              tag: Application
              value: General
        -
          uuid: 01b48abc0cf0481989d197d7c4841398
          name: 'Device description'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: system.descr
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: |
            MIB: SNMPv2-MIB
            A textual description of the entity.  This value should
            include the full name and version identification of the system's hardware type, software operating-system, and
            networking software.
          inventory_link: HARDWARE
          tags:
            -
              tag: Application
              value: General
        -
          uuid: ba732d873eb54b6ba504bde8e194622e
          name: 'Device location'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.6.0
          key: system.location
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: |
            MIB: SNMPv2-MIB
            The physical location of this node (e.g., `telephone closet, 3rd floor').  If the location is unknown, the value is the zero-length string.
          inventory_link: LOCATION
          tags:
            -
              tag: Application
              value: General
        -
          uuid: 3893ed7329244c26a2c7033a35412bdc
          name: 'Device name'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.5.0
          key: system.name
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: |
            MIB: SNMPv2-MIB
            An administratively-assigned name for this managed node.By convention, this is the node's fully-qualified domain name.  If the name is unknown, the value is the zero-length string.
          inventory_link: NAME
          tags:
            -
              tag: Application
              value: General
        -
          uuid: 02434669b07f4018bfbca49d6470e283
          name: 'System object ID'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.2.0
          key: system.objectid
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: |
            MIB: SNMPv2-MIB
            The vendor's authoritative identification of the network management subsystem contained in the entity.  This value is allocated within the SMI enterprises subtree (1.3.6.1.4.1) and provides an easy and unambiguous means for determining`what kind of box' is being managed.  For example, if vendor`Flintstones, Inc.' was assigned the subtree1.3.6.1.4.1.4242, it could assign the identifier 1.3.6.1.4.1.4242.1.1 to its `Fred Router'.
          tags:
            -
              tag: Application
              value: General
        -
          uuid: d3a50b5e75f44e1d9bca8191a1728d36
          name: 'Device uptime'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: 'system.uptime[sysUpTime]'
          delay: 30s
          history: 2w
          trends: '0'
          units: uptime
          description: |
            MIB: SNMPv2-MIB
            The time (in hundredths of a second) since the network management portion of the system was last re-initialized.
          preprocessing:
            -
              type: MULTIPLIER
              parameters:
                - '0.01'
          tags:
            -
              tag: Application
              value: Status
          triggers:
            -
              uuid: 1dd0c56f52fb4277b09169392bad359d
              expression: 'last(/vigor3910/system.uptime[sysUpTime])<10m'
              name: '{HOST.NAME} has been restarted'
              priority: WARNING
              description: |
                Last value: {ITEM.LASTVALUE1}.
                The device uptime is less than 10 minutes
              manual_close: 'YES'
              dependencies:
                -
                  name: 'No SNMP data collection'
                  expression: 'max(/vigor3910/zabbix[host,snmp,available],{$SNMP_TIMEOUT})=0'
        -
          uuid: 57cd3570457246bcbb1fd8bb3fb059c4
          name: 'SNMP availability'
          type: INTERNAL
          key: 'zabbix[host,snmp,available]'
          history: 2w
          trends: 0d
          valuemap:
            name: zabbix.host.available
          tags:
            -
              tag: Application
              value: Status
          triggers:
            -
              uuid: e7fc1459815144808284bf9bdda770dd
              expression: 'max(/vigor3910/zabbix[host,snmp,available],{$SNMP_TIMEOUT})=0'
              name: 'No SNMP data collection'
              priority: WARNING
              description: |
                Last value: {ITEM.LASTVALUE1}.
                SNMP is not available for polling. Please check device connectivity and SNMP settings.
      discovery_rules:
        -
          uuid: dad11dabd28341619a638d597bfbeb0f
          name: 'CPU Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.2.1.25.3.3.1.1]'
          key: hrProcessorLoad.discovery
          delay: 1h
          description: 'HOST-RESOURCES-MIB::hrProcessorTable discovery'
          item_prototypes:
            -
              uuid: 4faa9a61a1034a14b4f3ba5fde23fb8f
              name: '#{#SNMPINDEX}: CPU utilization'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.3.3.1.2.{#SNMPINDEX}'
              key: 'system.cpu.util[hrProcessorLoad.{#SNMPINDEX}]'
              delay: 3m
              value_type: FLOAT
              units: '%'
              description: |
                MIB: HOST-RESOURCES-MIB
                The average, over the last minute, of the percentage of time that this processor was not idle.
                Implementations may approximate this one minute smoothing period if necessary.
              tags:
                -
                  tag: Application
                  value: CPU
              trigger_prototypes:
                -
                  uuid: 48dbeb0b7df44304bb38f50f05b3e88c
                  expression: 'avg(/vigor3910/system.cpu.util[hrProcessorLoad.{#SNMPINDEX}],5m)>{$CPU_UTIL_MAX}'
                  name: '#{#SNMPINDEX}: High CPU utilization'
                  priority: AVERAGE
                  description: 'Last value: {ITEM.LASTVALUE1}.'
          graph_prototypes:
            -
              uuid: 4144b2e521994fa188f4c6f50795f248
              name: '#{#SNMPINDEX}: CPU utilization'
              ymin_type_1: FIXED
              ymax_type_1: FIXED
              graph_items:
                -
                  drawtype: GRADIENT_LINE
                  color: 199C0D
                  item:
                    host: vigor3910
                    key: 'system.cpu.util[hrProcessorLoad.{#SNMPINDEX}]'
        -
          uuid: e06708c894324d90a84da15a08a55eac
          name: 'Memory Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.2.1.25.2.3.1.3,{#ALLOC_UNITS},1.3.6.1.2.1.25.2.3.1.4,{#STORAGE_TYPE},1.3.6.1.2.1.25.2.3.1.2]'
          key: memory.discovery
          delay: 1h
          description: 'HOST-RESOURCES-MIB::hrStorage discovery with memory filter'
          item_prototypes:
            -
              uuid: 5077392e4d594f5788d8d11eb9d49ee6
              name: '#{#SNMPINDEX}: Memory utilization'
              type: CALCULATED
              key: 'vm.memory.pused[memoryUsedPercentage.{#SNMPINDEX}]'
              delay: 3m
              history: 30d
              units: '%'
              params: '(last(//vm.memory.units.used[hrStorageUsed.{#SNMPINDEX}])/last(//vm.memory.units.total[hrStorageSize.{#SNMPINDEX}]))*100'
              description: 'Memory utilization in %'
              tags:
                -
                  tag: Application
                  value: Memory
              trigger_prototypes:
                -
                  uuid: 7b1f9a0ddf3e42bd9427a6a29c91a7bd
                  expression: 'avg(/vigor3910/vm.memory.pused[memoryUsedPercentage.{#SNMPINDEX}],5m)>{$MEMORY_UTIL_MAX}'
                  name: '#{#SNMPINDEX}: High memory utilization'
                  priority: AVERAGE
                  description: 'Last value: {ITEM.LASTVALUE1}.'
            -
              uuid: 2ade80f5875b469f92c646a9d60e3436
              name: '#{#SNMPINDEX}: Total memory'
              type: CALCULATED
              key: 'vm.memory.total[memoryTotal.{#SNMPINDEX}]'
              delay: 3m
              history: 30d
              units: B
              params: '(last(//vm.memory.units.total[hrStorageSize.{#SNMPINDEX}])*last(//vm.memory.units[hrStorageAllocationUnits.{#SNMPINDEX}]))'
              description: 'Total memory in Bytes'
              tags:
                -
                  tag: Application
                  value: Memory
            -
              uuid: 4e5e11c4d81f4a21a240998133eb2e67
              name: '#{#SNMPINDEX}: Total memory in units'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.5.{#SNMPINDEX}'
              key: 'vm.memory.units.total[hrStorageSize.{#SNMPINDEX}]'
              delay: 3m
              history: 1w
              trends: '0'
              units: units
              description: |
                MIB: HOST-RESOURCES-MIB
                The size of the storage represented by this entry, in units of hrStorageAllocationUnits.
                This object is writable to allow remote configuration of the size of the storage area in those cases where such an operation makes sense and is possible on the underlying system.
                For example, the amount of main memory allocated to a buffer pool might be modified or the amount of disk space allocated to virtual memory might be modified.
              tags:
                -
                  tag: Application
                  value: 'Internal items'
            -
              uuid: 4ec3377b01724b74a4dd46ea6de00eb6
              name: '#{#SNMPINDEX}: Used memory in units'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.6.{#SNMPINDEX}'
              key: 'vm.memory.units.used[hrStorageUsed.{#SNMPINDEX}]'
              delay: 3m
              history: 1w
              trends: '0'
              units: units
              description: |
                MIB: HOST-RESOURCES-MIB
                The amount of the storage represented by this entry that is allocated, in units of hrStorageAllocationUnits.
              tags:
                -
                  tag: Application
                  value: 'Internal items'
            -
              uuid: 13af6904308c43f2b50e607480b67aa9
              name: '#{#SNMPINDEX}: Memory units'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.4.{#SNMPINDEX}'
              key: 'vm.memory.units[hrStorageAllocationUnits.{#SNMPINDEX}]'
              delay: 3m
              history: 1w
              trends: '0'
              description: |
                MIB: HOST-RESOURCES-MIB
                The size, in bytes, of the data objects allocated from this pool.
                If this entry is monitoring sectors, blocks, buffers, or packets, for example,
                this number will commonly be greater than one. Otherwise this number will typically be one.
              tags:
                -
                  tag: Application
                  value: 'Internal items'
            -
              uuid: fce15defa44d4d97a9566228edf40f3c
              name: '#{#SNMPINDEX}: Used memory'
              type: CALCULATED
              key: 'vm.memory.used[memoryUsed.{#SNMPINDEX}]'
              delay: 3m
              history: 30d
              units: B
              params: '(last(//vm.memory.units.used[hrStorageUsed.{#SNMPINDEX}])*last(//vm.memory.units[hrStorageAllocationUnits.{#SNMPINDEX}]))'
              description: 'Used memory in Bytes'
              tags:
                -
                  tag: Application
                  value: Memory
          graph_prototypes:
            -
              uuid: 97c9192a86b74d85bf8d6ef761d3a3d1
              name: '#{#SNMPINDEX}: Memory utilization'
              ymin_type_1: FIXED
              ymax_type_1: FIXED
              graph_items:
                -
                  drawtype: GRADIENT_LINE
                  color: 199C0D
                  item:
                    host: vigor3910
                    key: 'vm.memory.pused[memoryUsedPercentage.{#SNMPINDEX}]'
        -
          uuid: f806eccbf4034bd4aedbdbabd2a4744c
          name: 'Network Interfaces Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFOPERSTATUS},1.3.6.1.2.1.2.2.1.8,{#IFADMINSTATUS},1.3.6.1.2.1.2.2.1.7,{#IFALIAS},1.3.6.1.2.1.31.1.1.1.18,{#IFNAME},1.3.6.1.2.1.2.2.1.2,{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: net.if.discovery
          filter:
            conditions:
              -
                macro: '{#IFADMINSTATUS}'
                value: (1|3)
                formulaid: A
              -
                macro: '{#IFNAME}'
                value: '@Network interfaces for discovery'
                formulaid: B
              -
                macro: '{#IFOPERSTATUS}'
                value: (1|2|3|4|5|7)
                formulaid: C
          description: |
            Discovering interfaces from IF-MIB. Interfaces are not discovered:
            - with down(2) Administrative status
            - with notPresent(6) Operational status
            - loopbacks
          item_prototypes:
            -
              uuid: 6e04f663bc134c70921a54f42ff59905
              name: 'Interface {#IFDESCR}: Inbound packets discarded'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.13.{#SNMPINDEX}'
              key: 'net.if.in.discards[ifInDiscards.{#SNMPINDEX}]'
              delay: 5m
              history: 1w
              description: |
                MIB: IF-MIB
                The number of inbound packets which were chosen to be discarded
                even though no errors had been detected to prevent their being deliverable to a higher-layer protocol.
                One possible reason for discarding such a packet could be to free up buffer space.
                Discontinuities in the value of this counter can occur at re-initialization of the management system,
                and at other times as indicated by the value of ifCounterDiscontinuityTime.
              tags:
                -
                  tag: Application
                  value: 'Network interfaces'
            -
              uuid: e7164312523d48ff914176a0a1c6bc8c
              name: 'Interface {#IFDESCR}: Inbound packets with errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'net.if.in.errors[ifInErrors.{#SNMPINDEX}]'
              delay: 3m
              history: 1w
              description: |
                MIB: IF-MIB
                For packet-oriented interfaces, the number of inbound packets that contained errors preventing them from being deliverable to a higher-layer protocol.  For character-oriented or fixed-length interfaces, the number of inbound transmission units that contained errors preventing them from being deliverable to a higher-layer protocol. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              tags:
                -
                  tag: Application
                  value: 'Network interfaces'
            -
              uuid: bbb21b2dd0ee450b8e0a7618f83ca5ad
              name: 'Interface {#IFDESCR}: IPv4 address'
              type: SNMP_AGENT
              snmp_oid: 'IP-MIB::ipAdEntAddr{#SNMPINDEX}'
              key: 'net.if.in.ipv4[ifipv4.{#SNMPINDEX}]'
              delay: 30s
              history: '0'
              trends: '0'
              value_type: TEXT
              tags:
                -
                  tag: Application
                  value: 'Network interfaces'
            -
              uuid: afeb414fd51c4ebe8667fd36a51831fe
              name: 'Interface {#IFDESCR}: Bits received'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}'
              key: 'net.if.in[ifInOctets.{#SNMPINDEX}]'
              delay: 3m
              history: 30d
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets received on the interface,including framing characters. Discontinuities in the value of this counter can occurat re-initialization of the management system, and atother times as indicated by the value of ifCounterDiscontinuityTime.
              tags:
                -
                  tag: Application
                  value: 'Network interfaces'
            -
              uuid: fdeffcdaf11c42a9be86cce54edccae9
              name: 'Interface {#IFDESCR}: Outbound packets discarded'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.19.{#SNMPINDEX}'
              key: 'net.if.out.discards[ifOutDiscards.{#SNMPINDEX}]'
              delay: 5m
              history: 1w
              description: |
                MIB: IF-MIB
                The number of outbound packets which were chosen to be discarded
                even though no errors had been detected to prevent their being deliverable to a higher-layer protocol.
                One possible reason for discarding such a packet could be to free up buffer space.
                Discontinuities in the value of this counter can occur at re-initialization of the management system,
                and at other times as indicated by the value of ifCounterDiscontinuityTime.
              tags:
                -
                  tag: Application
                  value: 'Network interfaces'
            -
              uuid: cf0037a54e9f4314bfd6379814659af7
              name: 'Interface {#IFDESCR}: Outbound packets with errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'net.if.out.errors[ifOutErrors.{#SNMPINDEX}]'
              delay: 3m
              history: 1w
              description: |
                MIB: IF-MIB
                For packet-oriented interfaces, the number of outbound packets that contained errors preventing them from being deliverable to a higher-layer protocol.  For character-oriented or fixed-length interfaces, the number of outbound transmission units that contained errors preventing them from being deliverable to a higher-layer protocol. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              tags:
                -
                  tag: Application
                  value: 'Network interfaces'
            -
              uuid: 0abc1f5fe78d4452b26278a565d60741
              name: 'Interface {#IFDESCR}: Bits sent'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}'
              key: 'net.if.out[ifOutOctets.{#SNMPINDEX}]'
              delay: 3m
              history: 30d
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets transmitted out of the interface, including framing characters. Discontinuities in the value of this counter can occurat re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              tags:
                -
                  tag: Application
                  value: 'Network interfaces'
            -
              uuid: 936a1737f8c14569889f9711c8913074
              name: 'Interface {#IFDESCR}: Speed'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.5.{#SNMPINDEX}'
              key: 'net.if.speed[ifSpeed.{#SNMPINDEX}]'
              delay: 5m
              history: 1w
              trends: '0'
              units: bps
              description: |
                MIB: IF-MIB
                An estimate of the interface's current bandwidth in bits per second.
                For interfaces which do not vary in bandwidth or for those where no accurate estimation can be made,
                this object should contain the nominal bandwidth.
                If the bandwidth of the interface is greater than the maximum value reportable by this object then
                this object should report its maximum value (4,294,967,295) and ifHighSpeed must be used to report the interace's speed.
                For a sub-layer which has no concept of bandwidth, this object should be zero.
              tags:
                -
                  tag: Application
                  value: 'Network interfaces'
            -
              uuid: 3b9c01b4a32a488488192fb737989566
              name: 'Interface {#IFDESCR}: Operational status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'net.if.status[ifOperStatus.{#SNMPINDEX}]'
              history: 2w
              trends: '0'
              description: |
                MIB: IF-MIB
                The current operational state of the interface.
                - The testing(3) state indicateas that no operational packet scan be passed
                - If ifAdminStatus is down(2) then ifOperStatus should be down(2)
                - If ifAdminStatus is changed to up(1) then ifOperStatus should change to up(1) if the interface is ready to transmit and receive network traffic
                - It should change todormant(5) if the interface is waiting for external actions (such as a serial line waiting for an incoming connection)
                - It should remain in the down(2) state if and only if there is a fault that prevents it from going to the up(1) state
                - It should remain in the notPresent(6) state if the interface has missing(typically, hardware) components.
              valuemap:
                name: 'IF-MIB::ifOperStatus'
              tags:
                -
                  tag: Application
                  value: 'Network interfaces'
              trigger_prototypes:
                -
                  uuid: 1fa28930dc32465db45c03044f2a0912
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
                  name: 'Interface {#IFDESCR}: Link down'
                  priority: AVERAGE
                  description: |
                    Last value: {ITEM.LASTVALUE1}.
                    Interface is down
          trigger_prototypes:
            -
              uuid: f4d1f3097abb4cf6a11f405db047b565
              expression: |
                change(/vigor3910/net.if.speed[ifSpeed.{#SNMPINDEX}])<0 and last(/vigor3910/net.if.speed[ifSpeed.{#SNMPINDEX}])>0
                and
                (last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2)
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                (change(/vigor3910/net.if.speed[ifSpeed.{#SNMPINDEX}])>0 and last(/vigor3910/net.if.speed[ifSpeed.{#SNMPINDEX}],#2)>0) or
                (last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}])=2)
              name: 'Interface {#IFDESCR}: Ethernet has changed to lower speed than it was before'
              priority: INFO
              description: |
                Last value: {ITEM.LASTVALUE1}.
                This Ethernet connection has transitioned down from its known maximum speed. This might be a sign of autonegotiation issues. Ack to close.
              dependencies:
                -
                  name: 'Interface {#IFDESCR}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_expression: 'last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
            -
              uuid: 90ae9e55ff4f4e8caccb5bb29035af8e
              expression: |
                (avg(/vigor3910/net.if.in[ifInOctets.{#SNMPINDEX}],15m)>({$IF_UTIL_MAX:"{#IFNAME}"}/100)*last(/vigor3910/net.if.speed[ifSpeed.{#SNMPINDEX}]) or
                avg(/vigor3910/net.if.out[ifOutOctets.{#SNMPINDEX}],15m)>({$IF_UTIL_MAX:"{#IFNAME}"}/100)*last(/vigor3910/net.if.speed[ifSpeed.{#SNMPINDEX}])) and
                last(/vigor3910/net.if.speed[ifSpeed.{#SNMPINDEX}])>0
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                avg(/vigor3910/net.if.in[ifInOctets.{#SNMPINDEX}],15m)<(({$IF_UTIL_MAX:"{#IFNAME}"}-3)/100)*last(/vigor3910/net.if.speed[ifSpeed.{#SNMPINDEX}]) and
                avg(/vigor3910/net.if.out[ifOutOctets.{#SNMPINDEX}],15m)<(({$IF_UTIL_MAX:"{#IFNAME}"}-3)/100)*last(/vigor3910/net.if.speed[ifSpeed.{#SNMPINDEX}])
              name: 'Interface {#IFDESCR}: High bandwidth usage >{$IF_UTIL_MAX:"{#IFNAME}"}%'
              priority: WARNING
              description: 'Last value: {ITEM.LASTVALUE1}.'
              dependencies:
                -
                  name: 'Interface {#IFDESCR}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_expression: 'last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
            -
              uuid: 916fe269ae1c46878ec44be6b45e32d9
              expression: |
                avg(/vigor3910/net.if.in.errors[ifInErrors.{#SNMPINDEX}],5m)>{$IF_ERRORS_WARN:"{#IFNAME}"}
                or avg(/vigor3910/net.if.out.errors[ifOutErrors.{#SNMPINDEX}],5m)>{$IF_ERRORS_WARN:"{#IFNAME}"}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                avg(/vigor3910/net.if.in.errors[ifInErrors.{#SNMPINDEX}],5m)<{$IF_ERRORS_WARN:"{#IFNAME}"}*0.8
                and avg(/vigor3910/net.if.out.errors[ifOutErrors.{#SNMPINDEX}],5m)<{$IF_ERRORS_WARN:"{#IFNAME}"}*0.8
              name: 'Interface {#IFDESCR}: High error rate'
              priority: WARNING
              description: |
                Last value: {ITEM.LASTVALUE1}.
                Recovers when below 80% of {$IF_ERRORS_WARN:"{#IFNAME}"} threshold
              dependencies:
                -
                  name: 'Interface {#IFDESCR}: Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_expression: 'last(/vigor3910/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
          graph_prototypes:
            -
              uuid: 0cd5c8374d5648d1a01276139d9c253b
              name: 'Interface {#IFDESCR}: Network traffic'
              graph_items:
                -
                  color: 1A7C11
                  item:
                    host: vigor3910
                    key: 'net.if.in[ifInOctets.{#SNMPINDEX}]'
                -
                  sortorder: '1'
                  color: 2774A4
                  item:
                    host: vigor3910
                    key: 'net.if.out[ifOutOctets.{#SNMPINDEX}]'
                -
                  sortorder: '2'
                  color: F63100
                  item:
                    host: vigor3910
                    key: 'net.if.out.errors[ifOutErrors.{#SNMPINDEX}]'
                -
                  sortorder: '3'
                  color: A54F10
                  item:
                    host: vigor3910
                    key: 'net.if.in.errors[ifInErrors.{#SNMPINDEX}]'
                -
                  sortorder: '4'
                  color: FC6EA3
                  item:
                    host: vigor3910
                    key: 'net.if.out.discards[ifOutDiscards.{#SNMPINDEX}]'
                -
                  sortorder: '5'
                  color: 6C59DC
                  item:
                    host: vigor3910
                    key: 'net.if.in.discards[ifInDiscards.{#SNMPINDEX}]'
        -
          uuid: 4233fbabd61f4ab386ae1c59273df02a
          name: 'Storage Discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.2.1.25.2.3.1.3,{#ALLOC_UNITS},1.3.6.1.2.1.25.2.3.1.4,{#STORAGE_TYPE},1.3.6.1.2.1.25.2.3.1.2]'
          key: storage.discovery
          delay: 1h
          description: 'HOST-RESOURCES-MIB::hrStorage discovery with storage filter'
          item_prototypes:
            -
              uuid: 599eb656cd7748c2ad188389b53fb55f
              name: '{#SNMPVALUE}: Storage utilization'
              type: CALCULATED
              key: 'vfs.fs.pused[storageUsedPercentage.{#SNMPINDEX}]'
              delay: 5m
              history: 30d
              units: '%'
              params: '(last(//vfs.fs.units.used[hrStorageUsed.{#SNMPINDEX}])/last(//vfs.fs.units.total[hrStorageSize.{#SNMPINDEX}]))*100'
              description: 'Storage utilization in % for {#SNMPVALUE}'
              tags:
                -
                  tag: Application
                  value: Storage
              trigger_prototypes:
                -
                  uuid: e8be85a3f20f4318901c2fea00b9330c
                  expression: 'avg(/vigor3910/vfs.fs.pused[storageUsedPercentage.{#SNMPINDEX}],5m)>{$STORAGE_UTIL_CRIT}'
                  name: '{#SNMPVALUE}: Disk space is critically low'
                  priority: AVERAGE
                  description: 'Last value: {ITEM.LASTVALUE1}.'
                -
                  uuid: 425ed9c05bed4ce58f39497a368726ea
                  expression: 'avg(/vigor3910/vfs.fs.pused[storageUsedPercentage.{#SNMPINDEX}],5m)>{$STORAGE_UTIL_WARN}'
                  name: '{#SNMPVALUE}: Disk space is low'
                  priority: WARNING
                  description: 'Last value: {ITEM.LASTVALUE1}.'
                  dependencies:
                    -
                      name: '{#SNMPVALUE}: Disk space is critically low'
                      expression: 'avg(/vigor3910/vfs.fs.pused[storageUsedPercentage.{#SNMPINDEX}],5m)>{$STORAGE_UTIL_CRIT}'
            -
              uuid: a9b77d591d454ecb92b28a3921b9e072
              name: '{#SNMPVALUE}: Total space'
              type: CALCULATED
              key: 'vfs.fs.total[storageTotal.{#SNMPINDEX}]'
              delay: 5m
              history: 30d
              units: B
              params: '(last(//vfs.fs.units.total[hrStorageSize.{#SNMPINDEX}])*last(//vfs.fs.units[hrStorageAllocationUnits.{#SNMPINDEX}]))'
              description: 'Total space in Bytes'
              tags:
                -
                  tag: Application
                  value: Storage
            -
              uuid: fe2d5a44c3c94db2b591655a2e7414c5
              name: '{#SNMPVALUE}: Total space in units'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.5.{#SNMPINDEX}'
              key: 'vfs.fs.units.total[hrStorageSize.{#SNMPINDEX}]'
              delay: 5m
              history: 1w
              trends: '0'
              units: units
              description: |
                MIB: HOST-RESOURCES-MIB
                The size of the storage represented by this entry, in units of hrStorageAllocationUnits.
                This object is writable to allow remote configuration of the size of the storage area in those cases where such an operation makes sense and is possible on the underlying system.
                For example, the amount of main storage allocated to a buffer pool might be modified or the amount of disk space allocated to virtual storage might be modified.
              tags:
                -
                  tag: Application
                  value: 'Internal items'
            -
              uuid: 9e1c29a956834645a8f727f07475e776
              name: '{#SNMPVALUE}: Used storage in units'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.6.{#SNMPINDEX}'
              key: 'vfs.fs.units.used[hrStorageUsed.{#SNMPINDEX}]'
              delay: 5m
              history: 1w
              trends: '0'
              units: units
              description: |
                MIB: HOST-RESOURCES-MIB
                The amount of the storage represented by this entry that is allocated, in units of hrStorageAllocationUnits.
              tags:
                -
                  tag: Application
                  value: 'Internal items'
            -
              uuid: d39bd49e9c1e4ba68530b9027fce76e8
              name: '{#SNMPVALUE}: Storage units'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.4.{#SNMPINDEX}'
              key: 'vfs.fs.units[hrStorageAllocationUnits.{#SNMPINDEX}]'
              delay: 5m
              history: 1w
              trends: '0'
              description: |
                MIB: HOST-RESOURCES-MIB
                The size, in bytes, of the data objects allocated from this pool.
                If this entry is monitoring sectors, blocks, buffers, or packets, for example,
                this number will commonly be greater than one.  Otherwise this number will typically be one.
              tags:
                -
                  tag: Application
                  value: 'Internal items'
            -
              uuid: 5b807fbdbd1c4ac89c54358c01fbbdfd
              name: '{#SNMPVALUE}: Used space'
              type: CALCULATED
              key: 'vfs.fs.used[storageUsed.{#SNMPINDEX}]'
              delay: 5m
              history: 30d
              units: B
              params: '(last(//vfs.fs.units.used[hrStorageUsed.{#SNMPINDEX}])*last(//vfs.fs.units[hrStorageAllocationUnits.{#SNMPINDEX}]))'
              description: 'Used storage in Bytes'
              tags:
                -
                  tag: Application
                  value: Storage
      httptests:
        -
          uuid: fe544c09732645a9b82354c496fd9629
          name: 'Availability of Draytek Dashboard - {HOST.NAME}'
          attempts: '3'
          steps:
            -
              name: 'Vigor Login Page'
              url: 'http://{HOST.CONN}/weblogin.htm'
              required: Username
              status_codes: '200'
            -
              name: 'Log in'
              url: 'http://{HOST.CONN}/cgi-bin/wlogin.cgi'
              posts:
                -
                  name: sUserName
                  value: '{$WEB_USER}'
                -
                  name: sSysPass
                  value: '{$WEB_PASS}'
                -
                  name: btnOk
                  value: Login
              status_codes: '200'
            -
              name: 'Login check'
              url: 'http://{HOST.CONN}/menu.htm'
              required: 'All Rights Reserved.'
              status_codes: '200'
            -
              name: 'Log out'
              url: 'http://{HOST.CONN}/cgi-bin/wlogout.cgi'
              status_codes: '200'
            -
              name: 'Logout  check'
              url: 'http://{HOST.CONN}/weblogin.htm'
              required: Password
              status_codes: '200'
          tags:
            -
              tag: Application
              value: 'Web checks'
      macros:
        -
          macro: '{$SNMP_TIMEOUT}'
          value: 3m
      valuemaps:
        -
          uuid: 5e14f534840e41568d9098e7eb86d628
          name: 'IF-MIB::ifOperStatus'
          mappings:
            -
              value: '1'
              newvalue: up
            -
              value: '2'
              newvalue: down
            -
              value: '3'
              newvalue: testing
            -
              value: '4'
              newvalue: unknown
            -
              value: '5'
              newvalue: dormant
            -
              value: '6'
              newvalue: notPresent
            -
              value: '7'
              newvalue: lowerLayerDown
        -
          uuid: 0914804441e640809ca962ebb61e6ac0
          name: zabbix.host.available
          mappings:
            -
              value: '0'
              newvalue: 'not available'
            -
              value: '1'
              newvalue: available
            -
              value: '2'
              newvalue: unknown
